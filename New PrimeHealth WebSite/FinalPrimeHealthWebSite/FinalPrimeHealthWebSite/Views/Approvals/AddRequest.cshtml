
@{
    ViewBag.Title = "Add New Request";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var mailturl = ViewBag.ServiceUrl + "SendMail_Approval_For_User";
    var urlactivation = ViewBag.ServiceUrl + "GetActivationStatus";
    var getclaims = ViewBag.ServiceUrl + "GetClaims";
}

<style>
    .image-default-new {
        position: relative;
        height: 200px;
        width: 150px;
        /*background-image: url('/images/defaultpic.png');*/
        background-position: 50% 0px;
        background-size: cover;
        background-repeat: no-repeat;
    }
</style>
<div class="card card-outline-primary">
    <div class="card-header">
        <h4 class="m-b-0 text-white">New Approval Request</h4>
    </div>
    <div class="card-body">
        <div class="form-body">
            <h3 class="card-title m-t-15" style="color:forestgreen">You can track your request by adding/updating your E-mail.<a href="#" style="color:blue" class="ChangeEmail"><b>Click here</b></a> to add/update your Email</h3>
            <div class="alert alert-primary " id="div_Success" style="display:none">
                Ticket Added Successfully
            </div>
            <hr>
            <div class="row">
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="control-label">Request Title</label>

                        <input id="title" class="form-control" placeholder="Type Title" required="" type="text">

                    </div>
                </div>

                <!--/span-->
                <div class="col-lg-6">
                    <div class="form-group">
                        <label class="control-label">Request Message</label>

                        <textarea rows="7" cols="1000" id="subject" class="form-control" placeholder="Type Your Message" required="" type="text"></textarea>

                    </div>
                </div>
                <!--/span-->
            </div>

        </div>

        <br>
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div id="ImageArea">
                        <div class="row">
                            <div class="col-md-2">
                                <input type='file' onchange="readURL1(this)" id="photo1" accept="image/*" />

                                <br />
                                <img id="img1" class="image-default-new" src="~/images/defaultpic.png" />
                                <br />
                                <br />
                                <a id="Addphoto1" class="btn btn-outline-primary">Add another Photo</a>
                            </div>


                            <div class="col-md-2">
                                <input type='file' onchange="readURL2(this)" id="photo2" style="display:none" accept="image/*"/>


                                <br />
                                <img id="img2" class="image-default-new" src="~/images/defaultpic.png" style="display:none" />
                                <br />
                                <br />
                                <a id="Addphoto2" class="btn btn-outline-primary" style="display:none">Add another Photo</a>
                            </div>


                            <div class="col-md-2">
                                <input type='file' onchange="readURL3(this)" id="photo3" style="display:none" accept="image/*"/>


                                <br />
                                <img id="img3" class="image-default-new" src="~/images/defaultpic.png" style="display:none" />
                                <br />
                                <br />
                                <a id="Addphoto3" class="btn btn-outline-primary" style="display:none">Add another Photo</a>
                            </div>

                            <div class="col-md-2">
                                <input type='file' onchange="readURL4(this)" src="../images/defaultpic.png" id="photo4" style="display:none" accept="image/*"/>


                                <br />
                                <img id="img4" class="image-default-new" src="~/images/defaultpic.png" style="display:none" />
                                <br />
                                <br />
                                <a id="Addphoto4" class="btn btn-outline-primary" style="display:none">Add another Photo</a>
                            </div>


                            <div class="col-md-2">
                                <input type='file' onchange="readURL5(this)" id="photo5" style="display:none" accept="image/*"/>

                                <br />
                                <img id="img5" class="image-default-new" src="~/images/defaultpic.png" style="display:none" />
                            </div>
                        </div>
                        <br />
                    </div>
                </div>
            </div>
        </div>
        <div class="form-actions">
            <button type="button" class="btn btn-success" id="sendclaim" @*data-toggle="modal" data-target="#exampleModal"*@> <i class="fa fa-check"></i> Submit</button>
            <button type="button" class="btn btn-inverse" id="btn_Cancel">Cancel</button>
        </div>
    </div>
</div>
<!----------------------------------------------------------------------------------------->
<!----------------------------------------------------------------------------------------->
<!----------------------------------------------------------------------------------------->
<!----------------------------------------------------------------------------------------->
<!----------------------------------------------------------------------------------------->
<!----------------------------------------------------------------------------------------->

<script src="/Scripts/jquery-1.11.1.min.js"></script>

<script src="/js/lib/bootstrap/js/popper.min.js"></script>

<script src="/js/lib/bootstrap/js/bootstrap.min.js"></script>
<!-- slimscrollbar scrollbar JavaScript -->
<script src="~/js/jquery.slimscroll.js"></script>
<!--Menu sidebar -->
<script src="~/js/sidebarmenu.js"></script>
<!--stickey kit -->
<script src="~/js/lib/sticky-kit-master/dist/sticky-kit.min.js"></script>
<!--Custom JavaScript -->
<script src="~/js/custom.min.js"></script>

<link href="~/css/textareastye.css" rel="stylesheet">
<link href="~/css/lib/sweetalert/sweetalert.css" rel="stylesheet" />
<script src="~/js/lib/sweetalert/sweetalert.min.js"></script>

<script>

    function readURL1(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#img1')
                    .attr('src', e.target.result)
                    ;
            };

            reader.readAsDataURL(input.files[0]);
        }
    }



    function readURL2(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#img2')
                    .attr('src', e.target.result);
            };

            reader.readAsDataURL(input.files[0]);
        }
    }


    function readURL3(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#img3')
                    .attr('src', e.target.result);
            };

            reader.readAsDataURL(input.files[0]);
        }
    }


    function readURL4(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#img4')
                    .attr('src', e.target.result);
            };

            reader.readAsDataURL(input.files[0]);
        }
    }


    function readURL5(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#img5')
                    .attr('src', e.target.result);
            };

            reader.readAsDataURL(input.files[0]);
        }
    }

    $(document).ready(function () {
        var name =getcookie("Name");


        $("#medicalid").append(name);
    });
    var imgurl = "";
    var imgNme;
    var imgurl2 = "";
    var imgNme2;
    var imgurl3 = "";
    var imgNme3;
    var imgurl4 = "";
    var imgNme4;
    var imgurl5 = "";
    var imgNme5;



    function uploadPhoto(imageURI) {


    }


    function uploadPhoto2(imageURI2) {

    }



    function uploadPhoto3(imageURI3) {

    }

    function uploadPhoto4(imageURI4) {

    }


    function uploadPhoto5(imageURI5) {

    }
    function win(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
    }
    function fail(error) {
        //alert("An error has occurred: Code = " + error.code);
        //console.log("upload error source " + error.source);
        //console.log("upload error target " + error.target);
    }
    $("#Addphoto1").click(function () {
        debugger;
        $("#photo2").show();
        $("#Addphoto2").show();
        $("#Addphoto1").hide();
        $("#img2").show();

    });
    $("#Addphoto2").click(function () {
        $("#photo3").show();
        $("#Addphoto3").show();
        $("#Addphoto2").hide();
        $("#img3").show();
    });
    $("#Addphoto3").click(function () {
        $("#photo4").show();
        $("#Addphoto4").show();
        $("#Addphoto3").hide();
        $("#img4").show();

    });
    $("#Addphoto4").click(function () {
        $("#photo5").show();
        $("#Addphoto5").hide();
        $("#img5").show();

    });
     $("#Addphoto4").click(function () {
        $("#photo5").show();
        $("#Addphoto4").hide();
        $("#img5").show();

    });
 
    $("#sendclaim").click(function ()
    {
        var result = "";
        var medicalID = getcookie("Medical_id");

        var data = {
            medical: medicalID
        }
        var sub = $("#subject").val();
        var title = $("#title").val();
        $.ajax({
            type: 'Get',
            dataType: 'json',
            data: data,
            url: "@urlactivation",
            success: function (data) {
                result = data;
                if (result != "Activated") {
                  //  alert("Your account is either disabled or being activated... \r Please try again in 10 minutes");
                    swal({
                        title: "error",
                        text: "Your account is either disabled or being activated... \r Please try again in 10 minutes",
                        type: "warning",
                        //type: "error",
                        confirmButtonClass: "btn-danger",
                        confirmButtonText: "OK",
                        closeOnConfirm: true
                    });
                }
                else if (sub == "" || title == "" || document.getElementById("photo1").value == "") {
                    // alert("Please fill in all required fields");
                    swal({
                        title: "warning",
                        text: "Please fill in all required fields",
                        //type: "warning",
                        type: "warning",
                        confirmButtonClass: "btn-danger",
                        confirmButtonText: "OK",
                        closeOnConfirm: true
                    });
                }
                else {
                     PostRequest();
                }
            },
            error: function (error) {
                // sweetAlert("Error!", "Please check your internet connection " , "danger");
                swal({
                    title: "error",
                    text: "Please check your internet connection ",
                    //type: "warning",
                    type: "error",
                    confirmButtonClass: "btn-danger",
                    confirmButtonText: "OK",
                    closeOnConfirm: true
                });

            }
        });
 
    });
    function SendMailToCallCenter() {
        var medical = getcookie("Medical_id");
        var username = getcookie("Name");
        var subject = $("#title").val();
        var type = "Pending Requests";
        var data = {
            username: username,
            medicalID: medical,
            subject: subject,
            type: type
        };
        $.ajax({
            url: "@mailturl",
            type: 'Get',
            data: data,
            async: false,
            dataType: "json",
            success: function (data) {
                if (data == "Success") {
                }
            },
            error: function (error) {
            }
        });
    }
    function SendMail_Approval_For_User() {
        var medical = getcookie("Medical_id");
        var username = getcookie("Name");
        var data = {
            medicalID: medical,
            username: username
        };
        $.ajax({
            url: "@mailturl",
            type: 'Get',
            data: data,
            async: false,
            dataType: "json",
            success: function (data) {
                if (data == "Success") {
                }
            },
            error: function (error) {
            }
        });
    }

    function PostRequest() {
        var sub = $("#subject").val();
        var title = $("#title").val();

            var img_1_Base64;
            var img_2_Base64;
            var img_3_Base64;
            var img_4_Base64;
            var img_5_Base64;
            if (document.getElementById("photo1").value!="")
            {
                var img1 = document.getElementById("img1");

                img_1_Base64 = imageToBase64(img1);
            }

            if (document.getElementById("photo2").value!= "")
            {
                var img2 = document.getElementById("img2");

                img_2_Base64 = imageToBase64(img2);
            }

            if (document.getElementById("photo3").value != "")
            {
                var img3 = document.getElementById("img3");

                img_3_Base64 = imageToBase64(img3);
            }

            if (document.getElementById("photo4").value != "")
            {
                var img4 = document.getElementById("img4");

                img_4_Base64 = imageToBase64(img4);
            }

            if (document.getElementById("photo5").value != "")
            {
                var img5 = document.getElementById("img5");

                img_5_Base64 = imageToBase64(img5);
            }

            var requestDTO;
            var medical = getcookie("Medical_id");
            var name = getcookie("Name");
            var url = "@getclaims";
            if ((getcookie("ReqStatus") == "Special")) {
                requestDTO = {

                    Medical: medical,
                    ImgName: img_1_Base64,
                    Imgname2: img_2_Base64,
                    Imgname3: img_3_Base64,
                    Imgname4: img_4_Base64,
                    Imgname5: img_5_Base64,
                    User: name,
                    Sub: sub,
                    Title: title,
                    ReqType: "Special",
                    Platform: "Website"
                };
            }
            else {
                requestDTO = {
                    Medical: medical,
                    ImgName: img_1_Base64,
                    Imgname2: img_2_Base64,
                    Imgname3: img_3_Base64,
                    Imgname4: img_4_Base64,
                    Imgname5: img_5_Base64,
                    User: name,
                    Sub: sub,
                    Title: title,
                    ReqType: "Normal",
                    Platform: "Website"
                };
            }

            $.ajax({
                url: url,
                type: 'Post',
                data: requestDTO,
                dataType: "json",
                success: function (data) {
                    if (data == "Success") {
                         SendMailToCallCenter();
                        SendMail_Approval_For_User();
                       // sweetAlert("Error!", "Your request has been sent successfully", "danger");
                        swal({
                            title: "Success!",
                            text: "Your request has been sent successfully",
                            //type: "warning",
                            type: "success",
                            confirmButtonClass: "btn-danger",
                            confirmButtonText: "OK",
                            closeOnConfirm: true,
                          
                        }, function () {
                            //location.reload();
                            window.location.href = "/Approvals/index";

                        }
                        );

                    }
                    else {
                      //  sweetAlert("Error!", "Please try again", "danger");
                        swal({
                            title: "warning",
                            text: "Please try again",
                            //type: "warning",
                            type: "warning",
                            confirmButtonClass: "btn-danger",
                            confirmButtonText: "OK",
                            closeOnConfirm: true
                        });


                    }
                },
                error: function (error) {
                    // sweetAlert("Error!", "Please check your internet connection", "danger");
                    swal({
                        title: "Error!",
                        text: "Please check your internet connection",
                        //type: "warning",
                        type: "error",
                        confirmButtonClass: "btn-danger",
                        confirmButtonText: "OK",
                        closeOnConfirm: true
                    });

                }
            });
    }
  

function imageToBase64(img) {
        var canvas, ctx, dataURL, base64;
        canvas = document.createElement("canvas");
        var image = document.createElement("img");
        image.src = img.src;
        ctx = canvas.getContext("2d");
        canvas.width = image.width;
        canvas.height = image.height;
        ctx.drawImage(image, 0, 0);
        dataURL = canvas.toDataURL("image/jpg");
        base64 = dataURL.replace(/^data:image\/png;base64,/, "");
        return base64;
    }

</script>